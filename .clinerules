# =========================================================
#  AIâ€‘Powered Studyâ€‘Guide Generator â€“ .clinerules
#  Last updated: 2025â€‘04â€‘19
# =========================================================

# ------------------------------------------------------------------
# ğŸ“  PROJECT OVERVIEW
# ------------------------------------------------------------------
# This repository contains a Python CLI/Web application that:
#  â€¢ Accepts a topic and produces a fiveâ€‘chapter study guide
#  â€¢ Calls the Perplexity AI API asynchronously (httpx + asyncio)
#  â€¢ Parses, cleans and structures results with Pydantic and pandas
#  â€¢ Generates responsive, minified HTML pages (Jinja2 + Tailwind)
#  â€¢ Provides a Typer CLI and optional Streamlit preview UI

# ------------------------------------------------------------------
# ğŸ§‘â€ğŸ’»  CODING & STYLE CONVENTIONS
# ------------------------------------------------------------------
- Follow PEPÂ 484 type hints; enforce Black (lineâ€‘lengthÂ =Â 88)Â Â :contentReference[oaicite:0]{index=0}
- Lint with Ruff; warnings are errorsÂ Â :contentReference[oaicite:1]{index=1}
- Group imports per Ruffâ€™s isort profile.
- One public class/function per file unless <200Â LOC.

# ------------------------------------------------------------------
# ğŸ”„  ASYNC & API RULES
# ------------------------------------------------------------------
- Use a single shared `httpx.AsyncClient` instance.Â Â :contentReference[oaicite:2]{index=2}
- Wrap outbound calls in `tenacity.retry` with exponential backâ€‘off.Â Â :contentReference[oaicite:3]{index=3}
- Never block the loop; offâ€‘load CPU work to `asyncio.to_thread`.

# ------------------------------------------------------------------
# ğŸ”  SECURITY & SECRETS
# ------------------------------------------------------------------
IGNORE:
  - .env
  - **/secrets.*
  - **/*.pem
  - **/*.key

Practices:
- Secrets are injected via environment variables.
- Donâ€™t log full AI responses; log token counts only.

# ------------------------------------------------------------------
# ğŸ“š  DOCUMENTATION
# ------------------------------------------------------------------
- Update `README.md` + `/docs` with every PR.
- Architecture diagrams live in `/docs/architecture` (generated via `diagrams`).

# ------------------------------------------------------------------
# ğŸ§ª  TESTING
# ------------------------------------------------------------------
- Use **pytestâ€‘asyncio**; target â‰¥90Â % coverage.Â Â :contentReference[oaicite:4]{index=4}
- Unit tests => `tests/unit`, integration => `tests/int`.
- Snapshot generated HTML in `tests/fixtures/` and assert byte size Â±5Â %.

# ------------------------------------------------------------------
# ğŸ“ˆ  OBSERVABILITY
# ------------------------------------------------------------------
- Structured logging (`structlog`) JSON.
- Prometheus metrics for API latency, cache hits, token spend.

# ------------------------------------------------------------------
# ğŸ—‚  DIRECTORY & FILE IGNORE PATTERNS
# ------------------------------------------------------------------
IGNORE:
  - .venv/
  - __pycache__/
  - dist/
  - site/                 # generated static HTML
  - output/
  - *.sqlite
  - *.log

# ------------------------------------------------------------------
# ğŸ¤–  CLINE BEHAVIOUR
# ------------------------------------------------------------------
- Always include full imports & type hints.
- Ask clarifying questions before refactors touching â‰¥3Â files.
- For new modules, create a design doc (`*.md`) before code.
- Prefer composition over inheritance; avoid singletons.
